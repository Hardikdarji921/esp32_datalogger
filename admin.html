<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
	<script src="config.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }

        /* --- Button Styles for User Cards --- */
        .action-btn {
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            color: white;
        }
        .approve-btn {
            background-color: #22c55e; /* green-500 */
        }
        .approve-btn:hover {
            background-color: #16a34a; /* green-600 */
        }
        .delete-btn {
            background-color: #ef4444; /* red-500 */
        }
        .delete-btn:hover {
            background-color: #dc2626; /* red-600 */
        }
        .details-btn {
            background-color: #64748b; /* slate-500 */
        }
        .details-btn:hover {
            background-color: #475569; /* slate-600 */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">
  <div class="container mx-auto p-4 md:p-8">
    <header class="flex justify-between items-center mb-8">
      <div>
        <h1 class="text-4xl font-bold text-white">Admin Panel</h1>
        <p class="text-gray-400">User Management</p>
      </div>
      <a href="HomePage.html" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg transition-colors">&larr; Back to Dashboard</a>
    </header>
<div class="space-y-8">
  <div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
    <div class="p-6 border-b border-gray-700">
      <h2 class="text-2xl font-bold text-yellow-400">Pending Approval</h2>
    </div>
    <div class="overflow-x-auto">
      <table class="w-full text-left border-collapse">
        <thead class="bg-gray-700/50 text-gray-400 text-xs uppercase">
          <tr>
            <th class="p-4">User Info</th>
            <th class="p-4">Company</th>
            <th class="p-4 text-right">Actions</th>
          </tr>
        </thead>
        <tbody id="pendingUsers" class="divide-y divide-gray-700"></tbody>
      </table>
    </div>
  </div>

  <div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
    <div class="p-6 border-b border-gray-700">
      <h2 class="text-2xl font-bold text-green-400">Active Users</h2>
    </div>
    <div class="overflow-x-auto">
      <table class="w-full text-left border-collapse">
        <thead class="bg-gray-700/50 text-gray-400 text-xs uppercase">
          <tr>
            <th class="p-4">User Info</th>
            <th class="p-4">Company</th>
            <th class="p-4 text-right">Actions</th>
          </tr>
        </thead>
        <tbody id="activeUsers" class="divide-y divide-gray-700"></tbody>
      </table>
    </div>
  </div>
</div>
  </div>
  <script>
	
    const token = localStorage.getItem('token');

    // Function to create the HTML for a user card
	function createUserCard(user) {
		const row = document.createElement('tr');
		row.className = 'hover:bg-gray-700/50 transition-colors';
		
		const approveButton = !user.is_active 
			? `<button onclick="approveUser(${user.id})" class="action-btn approve-btn">Approve</button>` 
			: '';
		const deleteButton = user.role !== 'admin' 
			? `<button onclick="deleteUser(${user.id})" class="action-btn delete-btn">Delete</button>` 
			: '';

		row.innerHTML = `
			<td class="p-4">
				<div class="flex flex-col">
					<span class="text-white font-bold">${user.full_name}</span>
					<span class="text-gray-400 text-xs">@${user.username}</span>
					<span class="text-indigo-400 text-xs">${user.email}</span>
				</div>
			</td>
			<td class="p-4 text-gray-300 text-sm">
				${user.company || 'N/A'}
			</td>
			<td class="p-4 text-right">
				<div class="flex justify-end items-center space-x-2">
					${approveButton}
					${deleteButton}
					<button onclick="toggleDetails(this, ${user.id})" class="action-btn details-btn">Details</button>
				</div>
			</td>
		`;

		// Create a hidden details row that can be toggled
		const detailsRow = document.createElement('tr');
		detailsRow.id = `details-${user.id}`;
		detailsRow.className = 'bg-gray-900/50 hidden';
		detailsRow.innerHTML = `
			<td colspan="3" class="p-6">
				<div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
					<div><strong class="text-gray-400 block uppercase text-xs">DOB</strong> <span class="text-gray-200">${user.dob || 'N/A'}</span></div>
					<div><strong class="text-gray-400 block uppercase text-xs">Birth Place</strong> <span class="text-gray-200">${user.birth_place || 'N/A'}</span></div>
					<div><strong class="text-gray-400 block uppercase text-xs">Mobile</strong> <span class="text-gray-200">${user.mobile_number || 'N/A'}</span></div>
					<div><strong class="text-gray-400 block uppercase text-xs">Address</strong> <span class="text-gray-200">${user.address || 'N/A'}</span></div>
				</div>
			</td>
		`;

		// Return an array or a fragment so both rows can be appended
		const fragment = document.createDocumentFragment();
		fragment.appendChild(row);
		fragment.appendChild(detailsRow);
		return fragment;
	}

	// Updated toggle function
	function toggleDetails(button, userId) {
		const detailsRow = document.getElementById(`details-${userId}`);
		if (detailsRow.classList.contains('hidden')) {
			detailsRow.classList.remove('hidden');
			button.textContent = 'Close';
		} else {
			detailsRow.classList.add('hidden');
			button.textContent = 'Details';
		}
	}

    // Fetch and display all users
    async function fetchUsers() {
        const response = await fetch(`${APP_CONFIG.API_BASE_URL}/api/admin/users`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'x-access-token': token
            }
        });

        if (!response.ok) {
            console.error('Failed to fetch users:', response.statusText);
            return;
        }

        const users = await response.json();
        const pendingUsersContainer = document.getElementById('pendingUsers');
        const activeUsersContainer = document.getElementById('activeUsers');

        pendingUsersContainer.innerHTML = '';
        activeUsersContainer.innerHTML = '';

        users.forEach(user => {
            const userCard = createUserCard(user);
            if (user.is_active) {
                activeUsersContainer.appendChild(userCard);
            } else {
                pendingUsersContainer.appendChild(userCard);
            }
        });
    }

    // Approve a user
    async function approveUser(userId) {
        const response = await fetch(`${APP_CONFIG.API_BASE_URL}/api/admin/approve/${userId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'x-access-token': token
            }
        });

        if (response.ok) {
            fetchUsers();
        } else {
            console.error('Failed to approve user:', response.statusText);
        }
    }

    // Delete a user
    async function deleteUser(userId) {
        if (!confirm('Are you sure you want to delete this user?')) return;

        const response = await fetch(`${APP_CONFIG.API_BASE_URL}/api/admin/users/${userId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'x-access-token': token
            }
        });

        if (response.ok) {
            fetchUsers();
        } else {
            console.error('Failed to delete user:', response.statusText);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        if (!token) {
            window.location.href = 'login.html';
        } else {
            fetchUsers();
        }
    });
  </script>
</body>
</html>