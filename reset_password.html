<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - Telematics Dashboard</title>
	<script src="config.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap'); body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen flex items-center justify-center p-4">

    <div class="max-w-md w-full mx-auto">
        <div class="bg-gray-800 rounded-xl shadow-lg p-8 border border-gray-700">
            <h1 class="text-3xl font-bold text-white text-center mb-2">Reset Your Password</h1>
            <p class="text-center text-gray-400 mb-8">Enter and confirm your new password below.</p>
            
            <form id="reset-password-form" class="space-y-4">
                <div>
                    <label for="password" class="text-sm font-medium text-gray-400">New Password</label>
                    <input type="password" id="password" class="mt-1 w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white" required>
                </div>
                <div>
                    <label for="confirm-password" class="text-sm font-medium text-gray-400">Confirm New Password</label>
                    <input type="password" id="confirm-password" class="mt-1 w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white" required>
                </div>
                <div>
                    <button type="submit" class="w-full mt-2 px-4 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg">
                        Reset Password
                    </button>
                </div>
            </form>

            <div id="message-box" class="mt-4 text-center text-sm"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resetForm = document.getElementById('reset-password-form');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirm-password');
            const messageBox = document.getElementById('message-box');

            // Get the token from the URL query string
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');

            if (!token) {
                messageBox.textContent = 'Invalid or missing reset token.';
                messageBox.className = 'mt-4 text-center text-sm text-red-400';
                resetForm.querySelector('button').disabled = true;
            }

            resetForm.addEventListener('submit', (event) => {
                event.preventDefault();
                messageBox.textContent = '';

                const password = passwordInput.value;
                const confirmPassword = confirmPasswordInput.value;

                if (password !== confirmPassword) {
                    messageBox.textContent = 'Passwords do not match.';
                    messageBox.className = 'mt-4 text-center text-sm text-red-400';
                    return;
                }

                fetch(`${APP_CONFIG.API_BASE_URL}/api/reset-password`, {		//used for run in Local system
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token: token, password: password }),
                })
                .then(response => response.json().then(data => ({ ok: response.ok, body: data })))
                .then(res => {
                    messageBox.textContent = res.body.message;
                    if (res.ok) {
                        messageBox.className = 'mt-4 text-center text-sm text-green-400';
                        resetForm.querySelector('button').disabled = true;
                        setTimeout(() => {
                            window.location.href = 'login.html'; // Redirect to login on success
                        }, 3000); // Wait 3 seconds
                    } else {
                        messageBox.className = 'mt-4 text-center text-sm text-red-400';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    messageBox.textContent = 'An error occurred. Please try again.';
                    messageBox.className = 'mt-4 text-center text-sm text-red-400';
                });
            });
        });
    </script>
</body>
</html>